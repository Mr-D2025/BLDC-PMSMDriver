# 解读逐飞硬件
逐飞开源电调网址https://gitee.com/seekfree/STC32G12K128_BLDC_Project#11%E6%97%A0%E5%88%B7%E7%94%B5%E6%9C%BA%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84
## 逐飞电调的设计原理图
<img width="1393" height="905" alt="image" src="https://github.com/user-attachments/assets/13ed3c4f-9e23-4881-a67c-a3fb2a3d05bd" />
<img width="1416" height="928" alt="image" src="https://github.com/user-attachments/assets/d7c96392-979c-4bd6-a174-8cc6629e2ed5" />
根据上面的原理图，可以将电调分成三个部分，这样的设计可以为我之后自行设计电调作为参考。

### 电源
采用LDO，将12V转为5V为MCU供电使用，而12V自身是给驱动电机用的。

### 电机驱动
由一个三相 Power Mosfet H桥及其预驱动IC组成。

### 控制器部分
由MCU及其外围电路及反馈控制输入组成。

## 细节品析
逐飞开源电调设计以其稳定，性能优越著称。下面品析一下其设计，元器件选型细节。

### 电源
LDO选用AMS1117-5V，一般而言LDO输出纹波小于DCDC电路，且输入电压在稳压允许范围内（使用3s电池的话比较勉强）。
<img width="507" height="106" alt="image" src="https://github.com/user-attachments/assets/d6a74609-79d4-49c4-b060-233f91869ba0" />

不过为了进一步减少电压纹波，输出端电容要采用钽电容，这里没有采用，可能是这里没有使用STC模拟功能,对纹波要求较低。

<img width="519" height="60" alt="image" src="https://github.com/user-attachments/assets/42234080-46c2-4db8-8aec-e667a25237ac" />

电源输入部分并联470uF电容，可以平滑电压，且有助于弥补电池输出电流不足的问题，此外由于电容可能存在的寄生参数，这里并联一些小电容。

### 电机驱动
功率开关管采用TPN2R703NL，额定电流45A，10V的时候内阻2.2$m\Omega$ 开启阈值电压2.3V

<img width="557" height="134" alt="image" src="https://github.com/user-attachments/assets/b91835eb-549f-4ac9-be41-d212de40a758" />

<img width="794" height="328" alt="image" src="https://github.com/user-attachments/assets/b1a3a416-5028-441c-b277-00740bf9d2e0" />

<img width="766" height="490" alt="image" src="https://github.com/user-attachments/assets/8604501f-27eb-47a5-9243-95eb7467479d" />

预驱动IC采用FD6288Q，体积小，性能好，且输出驱动电压在Mos管驱动范围内；供电为12V，使用BZT52C15进行钳位，这是因为希望输出驱动电压为15V。

<img width="449" height="498" alt="image" src="https://github.com/user-attachments/assets/2e2f6c66-fb9a-4acb-9742-de2c53aaa612" />

<img width="775" height="502" alt="image" src="https://github.com/user-attachments/assets/e3d732b1-8131-41cd-b911-19f7fb51c469" />

按手册推荐电路设计外围电路，其中每相上桥臂由于开通时会使得 $V_s$ 上升，导致 $V_{GS}$ 下降，管子立马关断，所以要采用自举电路来升压。

<img width="893" height="482" alt="image" src="https://github.com/user-attachments/assets/9e158e83-533e-45f2-bc91-822784387a50" />

### 控制器部分
按STC32G手册设计MCU外围电路，注意到STC主要使用内部晶振，所以没有晶振电路的设计。

<img width="696" height="548" alt="image" src="https://github.com/user-attachments/assets/aae646db-3ee9-437a-9407-dd4f8b64c16c" />

过零检测电路
人为将三相电星型连接，并根据电阻分压原理设计分压电路，使得每相电路电压可以被单片机测量。
然后将中性点以及三相参考点引到MCU硬件比较器输入口。
这里多加了几个电容组成RC滤波网络，但实际上没必要，因为MCU内部有数字滤波，多加的电容还会导致相位滞后，使得换向频繁。




